# æä½å†…å­˜æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— (2GBå†…å­˜)

## ğŸš¨ é‡è¦æç¤º

æ‚¨çš„æœåŠ¡å™¨å†…å­˜éå¸¸æœ‰é™ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚æœ¬æŒ‡å—ä¸“é—¨é’ˆå¯¹2GBå†…å­˜æœåŠ¡å™¨ä¼˜åŒ–ã€‚

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. é…ç½®å›½å†…é•œåƒæº (æ¨èï¼Œè§£å†³ç½‘ç»œæ…¢çš„é—®é¢˜)
```bash
chmod +x setup-china-mirrors.sh
./setup-china-mirrors.sh
```

### 2. æ·»åŠ  Swap ç©ºé—´
```bash
chmod +x add-swap.sh
./add-swap.sh 4G
sudo reboot  # é‡å¯åé‡æ–°è¿æ¥
```

### 3. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.production .env
nano .env  # ç¼–è¾‘é…ç½®
```

### 4. å¼€å§‹éƒ¨ç½²
```bash
chmod +x deploy.sh
./deploy.sh  # é¦–æ¬¡éƒ¨ç½²æˆ–å®Œæ•´é‡æ–°éƒ¨ç½²
```

### 5. æ—¥å¸¸æ›´æ–° (æ¨è)
```bash
./update-app.sh  # å¿«é€Ÿåº”ç”¨æ›´æ–°ï¼Œä¸é‡å¯æ•°æ®åº“
```

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

**å¿…é¡»ä¿®æ”¹çš„é…ç½®**:
```bash
POSTGRES_PASSWORD=your-secure-password
NEXTAUTH_SECRET=your-32-character-secret-key
NEXTAUTH_URL=http://121.89.202.27:3000
DATABASE_URL="postgresql://postgres:your-secure-password@postgres:5432/accounting_app?schema=public"
```

## ğŸ“Š å†…å­˜é…ç½®è¯´æ˜

### æä½å†…å­˜ä¼˜åŒ–:
- **PostgreSQL**: é™åˆ¶256MBå†…å­˜
- **Node.jsåº”ç”¨**: é™åˆ¶800MBå†…å­˜ï¼Œå †å†…å­˜256MB
- **ç³»ç»Ÿé¢„ç•™**: çº¦1GBç”¨äºç³»ç»Ÿå’Œswap
- **Swapç©ºé—´**: 4GB (ç§¯æä½¿ç”¨)

### æ€§èƒ½å‚æ•°:
- `shared_buffers=32MB` (PostgreSQL)
- `max_connections=10` (å‡å°‘è¿æ¥æ•°)
- `NODE_OPTIONS=--max-old-space-size=256` (Node.jså †å†…å­˜)
- `vm.swappiness=60` (ç§¯æä½¿ç”¨swap)

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
docker stats --no-stream

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker compose logs -f app

# ä»…é‡å¯åº”ç”¨ (æ¨èç”¨äºæ—¥å¸¸æ›´æ–°)
./update-app.sh

# é‡å¯åº”ç”¨å®¹å™¨
docker compose restart app

# å®Œå…¨é‡æ–°éƒ¨ç½² (æ•°æ®åº“ä¹Ÿä¼šé‡å¯)
./deploy.sh
```

## ğŸ”„ æ—¥å¸¸ç»´æŠ¤

### ä»£ç æ›´æ–° (æ¨è):
```bash
./update-app.sh  # å¿«é€Ÿæ›´æ–°ï¼Œ2-3åˆ†é’Ÿå®Œæˆ
```

### å®Œæ•´é‡æ–°éƒ¨ç½²:
```bash
./deploy.sh  # åŒ…å«æ•°æ®åº“é‡å¯ï¼Œ10-20åˆ†é’Ÿ
```

### ç½‘ç»œé—®é¢˜:
```bash
./setup-china-mirrors.sh  # é…ç½®å›½å†…é•œåƒæº
```

### æ•°æ®åº“è¿ç§»:
```bash
# å¦‚æœæœ‰æ–°çš„æ•°æ®åº“è¿ç§»
docker compose exec app npx prisma migrate deploy
```

### å®šæœŸç»´æŠ¤:
```bash
# æ¯å‘¨æ¸…ç†ä¸€æ¬¡ Docker
docker system prune -f

# æ¯æœˆé‡å¯ä¸€æ¬¡æœåŠ¡å™¨
sudo reboot
```

## ğŸ†˜ æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶å†…å­˜ä¸è¶³
1. **å¢åŠ æ›´å¤šswap**:
   ```bash
   ./add-swap.sh 6G  # å¢åŠ åˆ°6GB
   sudo reboot
   ```

2. **æ‰‹åŠ¨æ¸…ç†å†…å­˜**:
   ```bash
   # åœæ­¢ä¸å¿…è¦çš„æœåŠ¡
   sudo systemctl stop snapd
   sudo systemctl stop unattended-upgrades
   
   # æ¸…ç†ç¼“å­˜
   sync
   echo 3 | sudo tee /proc/sys/vm/drop_caches
   
   # é‡æ–°éƒ¨ç½²
   ./deploy.sh
   ```

### å¦‚æœåº”ç”¨æ›´æ–°å¤±è´¥
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs app

# å°è¯•é‡å¯åº”ç”¨
docker-compose restart app

# å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå®Œå…¨é‡æ–°éƒ¨ç½²
./deploy.sh
```

### å¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker-compose exec postgres pg_isready -U postgres

# é‡å¯æ•°æ®åº“ (æ³¨æ„ï¼šä¼šçŸ­æš‚ä¸­æ–­æœåŠ¡)
docker-compose restart postgres
```

## ğŸ”§ è®¿é—®åœ°å€

- **åº”ç”¨**: http://121.89.202.27:3000
- **ç®¡ç†åå°**: http://121.89.202.27:3000/admin

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ—¥å¸¸æ›´æ–°**: ä½¿ç”¨ `./update-app.sh` è€Œä¸æ˜¯ `./deploy.sh`
2. **å®šæœŸé‡å¯**: æ¯å‘¨é‡å¯ä¸€æ¬¡æœåŠ¡å™¨é‡Šæ”¾å†…å­˜ç¢ç‰‡
3. **ç›‘æ§å†…å­˜**: å®šæœŸè¿è¡Œ `free -h` æ£€æŸ¥å†…å­˜ä½¿ç”¨
4. **å¤‡ä»½æ•°æ®**: å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼Œç³»ç»Ÿå¯èƒ½ä¸ç¨³å®š
5. **é¿å…å¹¶å‘**: ä¸è¦åŒæ—¶è¿è¡Œå¤šä¸ªå†…å­˜å¯†é›†å‹æ“ä½œ

## âš ï¸ é‡è¦è­¦å‘Š

- ç³»ç»Ÿè¿è¡Œåœ¨æé™çŠ¶æ€ï¼Œå“åº”å¯èƒ½è¾ƒæ…¢
- é¦–æ¬¡éƒ¨ç½²å¯èƒ½éœ€è¦20-30åˆ†é’Ÿ
- åº”ç”¨æ›´æ–°é€šå¸¸åªéœ€è¦2-3åˆ†é’Ÿ
- é¿å…åŒæ—¶è¿è¡Œå…¶ä»–ç¨‹åº
- ä¸è¦ç¦ç”¨swapç©ºé—´