# 项目结构说明

## 1. 项目概述

这是一个基于 Next.js 16 的会计应用项目，采用 TypeScript 开发，使用 Prisma 作为 ORM，Tailwind CSS 作为样式框架。

## 2. 目录结构

```
d:\work\next/
├── .claude/              # Claude AI 助手配置
├── .husky/               # Git hooks 配置
├── .kiro/                # Kiro AI 开发工具配置
├── .vscode/              # VS Code 配置
├── prisma/               # 数据库模型和迁移
├── public/               # 静态资源文件
├── src/                  # 源代码目录
├── .dockerignore         # Docker 忽略文件
├── .gitignore            # Git 忽略文件
├── .lintstagedrc.json    # Lint-staged 配置
├── .prettierignore       # Prettier 忽略文件
├── .prettierrc           # Prettier 配置
├── Dockerfile            # Docker 构建文件
├── README.md             # 项目 README
├── components.json       # UI 组件配置
├── deploy.sh             # 部署脚本
├── docker-compose.yml    # Docker Compose 配置
├── eslint.config.mjs     # ESLint 配置
├── init-db.sql           # 数据库初始化脚本
├── next.config.ts        # Next.js 配置
├── nginx.conf            # Nginx 配置
├── package-lock.json     # 依赖锁文件
├── package.json          # 项目依赖配置
├── postcss.config.mjs    # PostCSS 配置
├── prisma.config.ts      # Prisma 配置
├── tsconfig.json         # TypeScript 配置
├── vitest.config.ts      # Vitest 测试配置
```

## 3. 主要目录详解

### 3.1 目录结构特点

本项目采用 **Next.js App Router** 架构，**不区分前后端目录**，而是采用一体化架构：

- **前端代码**：位于 `src/app/` 目录下的页面组件（如 `admin/`、`dashboard/`、`login/` 等）
- **后端代码**：位于 `src/app/api/` 目录下的 API 路由
- **共享代码**：`src/lib/` 目录下的服务、中间件、工具函数等，前后端共享使用

### 3.2 src/

源代码的主要目录，包含应用的所有业务逻辑和组件。

```
src/
├── app/                  # Next.js App Router（前后端一体化）
│   ├── admin/            # 管理员前端页面
│   ├── api/              # 后端 API 路由
│   │   ├── admin/        # 管理员后端接口
│   │   ├── auth/         # 认证后端接口
│   │   ├── transactions/ # 交易后端接口
│   │   └── user/         # 用户后端接口
│   ├── auth/             # 认证前端页面
│   ├── dashboard/        # 仪表板前端页面
│   ├── login/            # 登录前端页面
│   ├── register/         # 注册前端页面
│   ├── transactions/     # 交易前端页面
│   ├── user/             # 用户前端页面
│   ├── favicon.ico       # 网站图标
│   ├── globals.css       # 全局样式
│   ├── layout.tsx        # 根布局
│   └── page.tsx          # 首页
├── components/           # React 组件（前后端共享）
│   ├── ui/               # 基础 UI 组件
│   ├── StatisticsCharts.tsx  # 统计图表组件
│   ├── TransactionForm.tsx   # 交易表单组件
│   └── TransactionList.tsx   # 交易列表组件
├── lib/                  # 工具库和服务（前后端共享）
│   ├── middleware/       # 中间件（后端使用）
│   ├── services/         # 业务服务（前后端共享）
│   ├── types/            # TypeScript 类型定义（前后端共享）
│   ├── utils/            # 工具函数（前后端共享）
│   ├── validation/       # 验证逻辑（前后端共享）
│   ├── api.ts            # API 封装（前端使用）
│   ├── prisma.ts         # Prisma 客户端（后端使用）
│   └── utils.ts          # 通用工具函数（前后端共享）
└── test/                 # 测试文件
```

### 3.2 prisma/

数据库相关配置和迁移。

```
prisma/
├── migrations/           # 数据库迁移文件
├── schema.prisma         # 数据库模型定义
└── seed.ts               # 数据库种子数据
```

### 3.3 public/

静态资源文件，如图片、字体等。

```
public/
├── file.svg
├── globe.svg
├── next.svg
├── vercel.svg
└── window.svg
```

## 4. 核心配置文件

### 4.1 package.json

项目依赖和脚本配置，包含以下核心脚本：

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "format": "prettier --write .",
    "db:generate": "prisma generate",
    "db:push": "prisma db push",
    "db:migrate": "prisma migrate dev",
    "db:studio": "prisma studio",
    "db:seed": "tsx prisma/seed.ts",
    "test": "vitest --run"
  }
}
```

### 4.2 next.config.ts

Next.js 配置文件，包含应用的构建和运行配置。

### 4.3 tsconfig.json

TypeScript 配置文件，定义 TypeScript 编译选项。

### 4.4 prisma.config.ts

Prisma 配置文件，包含数据库连接和生成配置。

## 5. 部署相关

### 5.1 deploy.sh

项目部署脚本，用于将应用部署到生产环境。

### 5.2 Dockerfile

Docker 构建文件，用于创建应用的 Docker 镜像。

### 5.3 docker-compose.yml

Docker Compose 配置文件，用于定义和运行多容器 Docker 应用。

### 5.4 nginx.conf

Nginx 配置文件，用于反向代理和静态资源服务。

## 6. 开发工具

### 6.1 ESLint

代码质量检查工具，配置文件为 `eslint.config.mjs`。

### 6.2 Prettier

代码格式化工具，配置文件为 `.prettierrc`。

### 6.3 Husky

Git hooks 工具，用于在 Git 操作前执行脚本。

### 6.4 Vitest

测试框架，配置文件为 `vitest.config.ts`。

## 7. 技术栈

- **前端框架**: Next.js 16 (App Router)
- **语言**: TypeScript 5
- **样式**: Tailwind CSS 4
- **ORM**: Prisma 7
- **数据库**: PostgreSQL
- **UI 组件**: shadcn/ui
- **测试**: Vitest
- **构建**: Next.js Build System
- **部署**: Docker + Nginx

## 9. 主要功能模块

1. **认证模块**: 用户注册、登录、密码重置
2. **交易模块**: 交易记录的增删改查
3. **统计模块**: 财务数据统计和图表展示
4. **管理员模块**: 用户管理、系统设置、审计日志
5. **导出模块**: 数据导出功能
6. **备份模块**: 数据库备份和恢复

## 10. 架构特点

### 10.1 一体化架构

本项目采用 Next.js App Router 的一体化架构，主要特点：

- **前后端代码共存**：前端页面和后端 API 都位于 `src/app/` 目录下
- **共享代码库**：`src/lib/` 目录下的代码可以被前后端共享使用
- **统一构建流程**：使用 Next.js 统一构建前端和后端代码
- **简化部署**：只需部署一个 Next.js 应用即可同时提供前端和后端服务

### 10.2 优势

1. **开发效率高**：前后端代码在同一个项目中，便于共享类型定义和工具函数
2. **部署简单**：只需部署一个应用，无需维护前后端两个独立项目
3. **类型安全**：TypeScript 类型定义在前后端之间共享，减少类型不一致问题
4. **性能优化**：Next.js 提供的静态生成和服务端渲染等优化措施

### 10.3 适用场景

这种架构适合：
- 中小型 Web 应用
- 需要快速开发和部署的项目
- 前后端团队协作紧密的项目
- 对类型安全要求较高的项目

## 10. 开发流程

1. 克隆仓库
2. 安装依赖: `npm install`
3. 配置数据库连接
4. 生成 Prisma 客户端: `npm run db:generate`
5. 运行迁移: `npm run db:migrate`
6. 启动开发服务器: `npm run dev`
7. 运行测试: `npm run test`
8. 构建生产版本: `npm run build`
9. 启动生产服务器: `npm run start`

## 11. 部署流程

1. 构建 Docker 镜像
2. 运行 Docker 容器
3. 配置 Nginx 反向代理
4. 配置 SSL 证书
5. 启动监控和日志系统

## 12. 部署流程

1. 构建 Docker 镜像
2. 运行 Docker 容器
3. 配置 Nginx 反向代理
4. 配置 SSL 证书
5. 启动监控和日志系统

---

**更新时间**: 2025-12-24
**版本**: 1.0.0