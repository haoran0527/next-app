<view class="container">
  <view class="header">
    <text class="title">AI模型配置</text>
    <button class="add-btn" bindtap="showAddDialog">+ 添加模型</button>
  </view>

  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <view wx:else class="model-list">
    <view wx:if="{{models.length === 0}}" class="empty">
      <text class="empty-icon">🤖</text>
      <text class="empty-text">暂无模型配置</text>
    </view>

    <view wx:for="{{models}}" wx:key="id" class="model-card {{item.isActive ? 'active' : ''}}">
      <view class="model-name-row">
        <text class="model-name">{{item.name}}</text>
        <view wx:if="{{item.isActive}}" class="active-badge">当前使用</view>
      </view>

      <view class="model-details">
        <view class="detail-item">
          <text class="detail-label">API地址:</text>
          <text class="detail-value">{{item.baseUrl}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">模型:</text>
          <text class="detail-value">{{item.model}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">API密钥:</text>
          <text class="detail-value masked-key">{{item.apiKey}}</text>
        </view>
      </view>

      <view class="model-actions">
        <button
          class="action-btn {{item.isActive ? 'current-btn' : 'activate-btn'}}"
          data-model="{{item}}"
          bindtap="{{item.isActive ? '' : 'activateModel'}}"
          disabled="{{item.isActive}}"
        >{{item.isActive ? '当前使用' : '使用'}}</button>
        <button
          class="action-btn edit-btn"
          data-model="{{item}}"
          bindtap="showEditDialog"
        >编辑</button>
        <button
          class="action-btn delete-btn"
          data-model="{{item}}"
          bindtap="deleteModel"
        >删除</button>
      </view>
    </view>
  </view>

  <!-- 添加模态框 -->
  <view wx:if="{{showAddModal}}" class="modal-mask" bindtap="hideAddDialog">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">添加AI模型</text>
        <text class="modal-close" bindtap="hideAddDialog">×</text>
      </view>

      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">模型名称</text>
          <input
            class="form-input"
            placeholder="如：DeepSeek Chat"
            value="{{formData.name}}"
            data-field="name"
            bindinput="onInputChange"
          />
        </view>

        <view class="form-item">
          <text class="form-label">API地址</text>
          <input
            class="form-input"
            placeholder="如：https://api.deepseek.com"
            value="{{formData.baseUrl}}"
            data-field="baseUrl"
            bindinput="onInputChange"
          />
        </view>

        <view class="form-item">
          <text class="form-label">API密钥</text>
          <input
            class="form-input"
            placeholder="请输入API密钥"
            value="{{formData.apiKey}}"
            data-field="apiKey"
            bindinput="onInputChange"
          />
        </view>

        <view class="form-item">
          <text class="form-label">模型标识</text>
          <input
            class="form-input"
            placeholder="如：deepseek-chat"
            value="{{formData.model}}"
            data-field="model"
            bindinput="onInputChange"
          />
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideAddDialog">取消</button>
        <button class="modal-btn confirm-btn" bindtap="submitAdd">确定</button>
      </view>
    </view>
  </view>

  <!-- 编辑模态框 -->
  <view wx:if="{{showEditModal}}" class="modal-mask" bindtap="hideEditDialog">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">编辑AI模型</text>
        <text class="modal-close" bindtap="hideEditDialog">×</text>
      </view>

      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">模型名称</text>
          <input
            class="form-input"
            placeholder="如：DeepSeek Chat"
            value="{{formData.name}}"
            data-field="name"
            bindinput="onInputChange"
          />
        </view>

        <view class="form-item">
          <text class="form-label">API地址</text>
          <input
            class="form-input"
            placeholder="如：https://api.deepseek.com"
            value="{{formData.baseUrl}}"
            data-field="baseUrl"
            bindinput="onInputChange"
          />
        </view>

        <view class="form-item">
          <text class="form-label">API密钥（不修改请留空）</text>
          <input
            class="form-input"
            placeholder="留空则不修改"
            value="{{formData.apiKey}}"
            data-field="apiKey"
            bindinput="onInputChange"
          />
        </view>

        <view class="form-item">
          <text class="form-label">模型标识</text>
          <input
            class="form-input"
            placeholder="如：deepseek-chat"
            value="{{formData.model}}"
            data-field="model"
            bindinput="onInputChange"
          />
        </view>
      </view>

      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideEditDialog">取消</button>
        <button class="modal-btn confirm-btn" bindtap="submitEdit">确定</button>
      </view>
    </view>
  </view>
</view>
